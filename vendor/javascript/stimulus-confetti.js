import t from"canvas-confetti";function e(){return e=Object.assign?Object.assign.bind():function(t){for(var u=1;u<arguments.length;u++){var l=arguments[u];for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(t[h]=l[h])}return t},e.apply(this,arguments)}function r(t){return t.replace(/(?:[_-])([a-z0-9])/g,((t,u)=>u.toUpperCase()))}function n(t){return t.charAt(0).toUpperCase()+t.slice(1)}function s(t,u){const l=i(t);return Array.from(l.reduce(((t,l)=>(function(t,u){const l=t[u];return Array.isArray(l)?l:[]}(l,u).forEach((u=>t.add(u))),t)),new Set))}function i(t){const u=[];for(;t;)u.push(t),t=Object.getPrototypeOf(t);return u.reverse()}function o([t,y],b){return function(t){const y=`${m=t.token,m.replace(/([A-Z])/g,((t,u)=>`-${u.toLowerCase()}`))}-value`,b=function(t){const u=function(t){const u=a(t.typeObject.type);if(!u)return;const l=c(t.typeObject.default);if(u!==l)throw new Error(`The specified default value for the Stimulus Value "${t.controller?`${t.controller}.${t.token}`:t.token}" must match the defined type "${u}". The provided default value of "${t.typeObject.default}" is of type "${l}".`);return u}({controller:t.controller,token:t.token,typeObject:t.typeDefinition}),l=c(t.typeDefinition),h=a(t.typeDefinition),y=u||l||h;if(y)return y;throw new Error(`Unknown value type "${t.controller?`${t.controller}.${t.typeDefinition}`:t.token}" for "${t.token}" value`)}(t);var m;return{type:b,key:y,name:r(y),get defaultValue(){return function(t){const l=a(t);if(l)return u[l];const h=t.default;return void 0!==h?h:t}(t.typeDefinition)},get hasCustomDefaultValue(){return void 0!==c(t.typeDefinition)},reader:l[b],writer:h[b]||h.default}}({controller:b,token:t,typeDefinition:y})}function a(t){switch(t){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function c(t){switch(typeof t){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}return Array.isArray(t)?"array":"[object Object]"===Object.prototype.toString.call(t)?"object":void 0}(()=>{try{!function(){const t=function(t){function e(){return Reflect.construct(t,arguments,new.target)}return e.prototype=Object.create(t.prototype,{constructor:{value:e}}),Reflect.setPrototypeOf(e,t),e}((function(){this.a.call(this)}));t.prototype.a=function(){},new t}()}catch(t){return t=>class extends t{}}})();const u={get array(){return[]},boolean:!1,number:0,get object(){return{}},string:""},l={array(t){const u=JSON.parse(t);if(!Array.isArray(u))throw new TypeError(`expected value of type "array" but instead got value "${t}" of type "${c(u)}"`);return u},boolean:t=>!("0"==t||"false"==String(t).toLowerCase()),number:t=>Number(t),object(t){const u=JSON.parse(t);if(null===u||"object"!=typeof u||Array.isArray(u))throw new TypeError(`expected value of type "object" but instead got value "${t}" of type "${c(u)}"`);return u},string:t=>t},h={default:function(t){return`${t}`},array:d,object:d};function d(t){return JSON.stringify(t)}class p{constructor(t){this.context=t}static get shouldLoad(){return!0}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(t,{target:u=this.element,detail:l={},prefix:h=this.identifier,bubbles:y=!0,cancelable:b=!0}={}){const m=new CustomEvent(h?`${h}:${t}`:t,{detail:l,bubbles:y,cancelable:b});return u.dispatchEvent(m),m}}p.blessings=[function(t){return s(t,"classes").reduce(((t,u)=>{return Object.assign(t,{[`${l=u}Class`]:{get(){const{classes:t}=this;if(t.has(l))return t.get(l);{const u=t.getAttributeName(l);throw new Error(`Missing attribute "${u}"`)}}},[`${l}Classes`]:{get(){return this.classes.getAll(l)}},[`has${n(l)}Class`]:{get(){return this.classes.has(l)}}});var l}),{})},function(t){return s(t,"targets").reduce(((t,u)=>{return Object.assign(t,{[`${l=u}Target`]:{get(){const t=this.targets.find(l);if(t)return t;throw new Error(`Missing target element "${l}" for "${this.identifier}" controller`)}},[`${l}Targets`]:{get(){return this.targets.findAll(l)}},[`has${n(l)}Target`]:{get(){return this.targets.has(l)}}});var l}),{})},function(t){const u=function(t,u){return i(t).reduce(((t,u)=>(t.push(...function(t,u){const l=t.values;return l?Object.keys(l).map((t=>[t,l[t]])):[]}(u)),t)),[])}(t),l={valueDescriptorMap:{get(){return u.reduce(((t,u)=>{const l=o(u,this.identifier),h=this.data.getAttributeNameForKey(l.key);return Object.assign(t,{[h]:l})}),{})}}};return u.reduce(((t,u)=>Object.assign(t,function(t,u){const l=o(t,void 0),{key:h,name:y,reader:b,writer:m}=l;return{[y]:{get(){const t=this.data.get(h);return null!==t?b(t):l.defaultValue},set(t){void 0===t?this.data.delete(h):this.data.set(h,m(t))}},[`has${n(y)}`]:{get(){return this.data.has(h)||l.hasCustomDefaultValue}}}}(u))),l)}],p.targets=[],p.values={};const f=(t={})=>Object.keys(t).map((u=>`${u}:${t[u]}`)).join(";");class g extends p{constructor(...t){super(...t),this.clicked=!1,this.canvasElement=null}get canvas(){if(this.canvasElement)return this.canvasElement;const t=document.createElement("canvas");return t.style.cssText=f({position:"fixed",top:0,right:0,bottom:0,left:0,width:"100%",height:"100%","pointer-events":"none","z-index":"9999"}),document.body.appendChild(t),this.canvasElement=t,this.canvasElement}get instance(){return t.create(this.canvas,{resize:!0,useWorker:!0})}spray(t){t.preventDefault(),this.log("Spraying"),this.getStyle(t).then((()=>{this.log("Finished animation"),this.followValue&&(!1===this.clicked&&this.followLink(),this.clicked=!0)}))}getStyle(t){switch(this.animationValue){case"basic":default:return this.basic(t);case"school-pride":return this.schoolPride(t);case"stars":return this.stars(t)}}basic(t){return this.log("Basic started"),this.instance({particleCount:this.particleCountValue,startVelocity:this.startVelocityValue,spread:this.spreadValue,ticks:this.ticksValue,origin:{x:t.clientX/window.innerWidth,y:t.clientY/window.innerHeight}})}stars(t){this.log("Stars started");var u={spread:this.spreadValue,ticks:50,gravity:0,decay:.94,startVelocity:this.startVelocityValue,shapes:["star"],colors:["FFE400","FFBD00","E89400","FFCA6C","FDFFB8"],origin:{x:t.clientX/window.innerWidth,y:t.clientY/window.innerHeight}};return new Promise((t=>{setTimeout((()=>{this.instance(e({},u,{particleCount:this.particleCountValue,shapes:["star"]}))}),70),this.instance(e({},u,{particleCount:this.particleCountValue,shapes:["star"]})).then((()=>{this.log("Stars ended"),t()}))}))}schoolPride(t){return this.log("School pride started"),new Promise((t=>{var u=Date.now()+1e3*this.durationValue,l=[this.firstColorValue,this.secondColorValue];const h=this;!function s(){h.instance({particleCount:2,angle:60,spread:55,origin:{x:0},colors:l}),h.instance({particleCount:2,angle:120,spread:55,origin:{x:1},colors:l}),Date.now()<u?requestAnimationFrame(s):(h.log("School pride ended"),t())}()}))}followLink(){this.log("Following link");const t=document.createElement("a");t.style.cssText=f({opacity:0,display:"hidden"}),t.href=this.context.element.href,t.target=this.context.element.target,document.body.appendChild(t),t.click(),this.log("Followed link"),setTimeout((()=>{this.log("Reset state"),this.clicked=!1}),1)}log(t){this.debugValue&&console.log(`[Stimulus confetti] ${t}`)}}g.targets=["element"],g.values={follow:{type:Boolean,default:!0},animation:{type:String,default:"basic"},duration:{type:Number,default:5},firstColor:{type:String,default:"#0886DE"},secondColor:{type:String,default:"#FF6154"},particleCount:{type:Number,default:100},startVelocity:{type:Number,default:20},spread:{type:Number,default:360},ticks:{type:Number,default:90},debug:{type:Boolean,default:!1}};export{g as Confetti};

